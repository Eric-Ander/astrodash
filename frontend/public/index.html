<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AstroDashboard - Astronomical weather forecasting for stargazers">
    <title>AstroDashboard - Tonight's Sky Forecast</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" href="/favicon.svg">

    <!-- Swap favicon for staging environment -->
    <script>
      if (window.location.hostname.includes('staging')) {
        document.querySelector('link[rel="icon"]').href = '/favicon-staging.svg';
      }
    </script>

    <link rel="stylesheet" href="/css/styles.css">
    <!-- i18next for internationalization -->
    <script src="https://cdn.jsdelivr.net/npm/i18next@23.7.6/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-http-backend@2.4.2/i18nextHttpBackend.min.js"></script>
    <!-- Lit for card web components -->
    <script type="importmap">
    {
      "imports": {
        "lit": "https://cdn.jsdelivr.net/npm/lit@3.2.1/+esm",
        "lit/": "https://cdn.jsdelivr.net/npm/lit@3.2.1/",
        "lit-html": "https://cdn.jsdelivr.net/npm/lit-html@3.2.1/+esm",
        "lit-html/": "https://cdn.jsdelivr.net/npm/lit-html@3.2.1/",
        "lit-element/": "https://cdn.jsdelivr.net/npm/lit-element@4.1.1/",
        "@lit/reactive-element": "https://cdn.jsdelivr.net/npm/@lit/reactive-element@2.0.4/+esm",
        "@lit/reactive-element/": "https://cdn.jsdelivr.net/npm/@lit/reactive-element@2.0.4/"
      }
    }
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-controls">
                    <!-- Language selector hidden for now -->
                    <div class="language-selector hidden">
                        <select id="languageSelect" class="language-select">
                            <option value="en">English</option>
                            <option value="de">Deutsch</option>
                            <option value="es">Espa√±ol</option>
                            <option value="fr">Fran√ßais</option>
                        </select>
                    </div>
                    
                    <!-- User Menu (shown when logged in) -->
                    <div id="userMenu" class="user-menu hidden">
                        <button class="user-menu-button" id="userMenuButton">
                            <span class="user-icon">üë§</span>
                            <span id="userName">User</span>
                        </button>
                        <div class="user-dropdown hidden" id="userDropdown">
                            <div class="dropdown-item" id="savedLocationsBtn">
                                <span>üìç</span> Saved Locations
                            </div>
                            <div class="dropdown-item hidden" id="adminPanelBtn">
                                <span>üëë</span> User Management
                            </div>
                            <div class="dropdown-item" id="logoutBtn">
                                <span>üö™</span> Logout
                            </div>
                        </div>
                    </div>
                    
                    <!-- Login Button (shown when not logged in) -->
                    <button id="loginButton" class="login-button">
                        <span>üîê</span> Login
                    </button>
                </div>
                
                <h1 class="logo">
                    <span class="star-icon">üî≠</span>
                    <span>AstroDashboard</span>
                </h1>
                <p class="tagline">üåü Clear skies for stargazing tonight? üî≠</p>
            </div>
        </header>

        <!-- Search Section -->
        <section class="search-section">
            <div class="search-container">
                <div class="search-tabs">
                    <button class="tab-button active" data-tab="city" data-i18n="search.cityTab">City Name</button>
                    <button class="tab-button" data-tab="coordinates" data-i18n="search.coordinatesTab">Coordinates</button>
                </div>

                <!-- City Search Form -->
                <form id="cityForm" class="search-form active">
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="cityInput" 
                            data-i18n="[placeholder]search.cityPlaceholder"
                            placeholder="Enter city name (e.g., London, Tokyo, New York)"
                            class="search-input"
                            autocomplete="off"
                        >
                        <button type="submit" class="search-button">
                            <span class="search-icon">üîç</span>
                            <span data-i18n="search.searchButton">Search</span>
                        </button>
                    </div>
                </form>

                <!-- Coordinates Search Form -->
                <form id="coordinatesForm" class="search-form">
                    <div class="coordinates-inputs">
                        <div class="input-group">
                            <label for="latInput" data-i18n="search.latitudeLabel">Latitude</label>
                            <input 
                                type="number" 
                                id="latInput" 
                                data-i18n="[placeholder]search.latitudePlaceholder"
                                placeholder="e.g., 51.5074"
                                step="0.0001"
                                min="-90"
                                max="90"
                                class="search-input"
                            >
                        </div>
                        <div class="input-group">
                            <label for="lonInput" data-i18n="search.longitudeLabel">Longitude</label>
                            <input 
                                type="number" 
                                id="lonInput" 
                                data-i18n="[placeholder]search.longitudePlaceholder"
                                placeholder="e.g., -0.1278"
                                step="0.0001"
                                min="-180"
                                max="180"
                                class="search-input"
                            >
                        </div>
                    </div>
                    <button type="submit" class="search-button">
                        <span class="search-icon">üîç</span>
                        <span data-i18n="search.searchButton">Search</span>
                    </button>
                </form>
            </div>

            <!-- Location Info (shown after search) -->
            <div id="locationInfo" class="location-info hidden">
                <h2 id="locationName"></h2>
                <p id="locationDetails"></p>
            </div>
        </section>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-indicator hidden">
            <div class="spinner"></div>
            <p data-i18n="loading.message">Fetching tonight's sky forecast...</p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message hidden"></div>

        <!-- Card Dashboard (plugin cards render here) -->
        <div id="cardDashboard" class="card-dashboard hidden"></div>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2026 AstroDashboard Eric Anderson | Weather data provided by OpenWeatherMap</p>
        </footer>
    </div>

    <!-- Login/Register Modal -->
    <div id="authModal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close" id="closeAuthModal">&times;</span>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="register">Register</button>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-form active">
                <h2>Login to AstroWeather</h2>
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <div class="error-message hidden" id="loginError"></div>
                <button class="auth-submit-btn" id="loginSubmitBtn">Login</button>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form">
                <h2>Create Account</h2>
                <div class="form-group">
                    <label for="registerName">Name (optional)</label>
                    <input type="text" id="registerName" placeholder="Your Name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    <small>At least 6 characters</small>
                </div>
                <div class="error-message hidden" id="registerError"></div>
                <button class="auth-submit-btn" id="registerSubmitBtn">Create Account</button>
            </div>
        </div>
    </div>

    <!-- Saved Locations Modal -->
    <div id="savedLocationsModal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close" id="closeSavedLocationsModal">&times;</span>
            <h2>üìç Saved Locations</h2>
            <div id="savedLocationsList" class="saved-locations-list">
                <div class="loading">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="modal hidden">
        <div class="modal-content admin-modal">
            <span class="modal-close" id="closeAdminModal">&times;</span>
            <h2>üëë User Management</h2>

            <!-- Stats Section -->
            <div id="adminStats" class="admin-stats">
                <div class="admin-loading">Loading statistics...</div>
            </div>

            <!-- Search -->
            <div class="admin-search">
                <input type="text" id="adminSearchInput" placeholder="Search by email or name..." class="admin-search-input">
            </div>

            <!-- Users List -->
            <div id="adminUsersList" class="admin-users-list">
                <div class="admin-loading">Loading users...</div>
            </div>

            <!-- Pagination -->
            <div class="admin-pagination">
                <button id="adminPrevPage" class="pagination-btn" disabled>‚Üê Previous</button>
                <span id="adminPageInfo">Page 1 of 1</span>
                <button id="adminNextPage" class="pagination-btn">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Save Current Location Button (shown after search) -->
    <div id="saveLocationContainer" class="save-location-container hidden">
        <button id="saveCurrentLocationBtn" class="save-location-btn">
            ‚≠ê Save This Location
        </button>
    </div>

    <!-- City Selection Modal (for disambiguation) -->
    <div id="citySelectModal" class="modal hidden">
        <div class="modal-content city-select-modal">
            <span class="modal-close" id="closeCitySelectModal">&times;</span>
            <h2>üìç Select Location</h2>
            <p class="city-select-info">Multiple locations found. Please select the correct one:</p>
            <div id="citySelectList" class="city-select-list"></div>
        </div>
    </div>

    <script src="/js/i18n.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/auth-ui.js"></script>
    <script src="/js/admin.js"></script>
    <script src="/js/app.js"></script>
    <!-- Card system (ES modules) -->
    <script type="module" src="/js/card-manager.js"></script>
</body>
</html>
